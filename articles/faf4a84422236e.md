---
title: "Neovimのextuiであそぼう"
emoji: "⚙️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [neovim]
published: true
---

:::message
nightly / HEADビルド限定の絶賛開発中な機能なので、使うときは最新の情報を参照してください。
:::

こんにちは、yank.nvimです。現状Neovimのnightly版またはHEADビルドで使用可能なextuiについて簡単な使い方と、自分が使っている設定を紹介します。

## 使い方
有効化するためにはこのような設定をします。
```lua:init.lua
local ok, extui = pcall(require, "vim._extui")
if ok then
    extui.enable({
        enable = true,
        target = "box", -- メッセージをコマンドラインに出す("cmd")か、画面右下にフローティング表示する("box")か
        timeout = 4000, -- メッセージがタイムアウトするまでの時間
    })
end
```

お好みで`cmdheight=0`も。
```lua:init.lua
vim.opt.cmdheight = 0
```

## 主な機能
### コマンドラインのシンタックスハイライト
![](https://storage.googleapis.com/zenn-user-upload/633a29c073d8-20251214.png =250x)
*ハイライトがつく*
コマンドにシンタックスハイライトが効くようになります。

### `:message`などのフローティング化
`:message`などがフローティングウィンドウになり、出力をコピーできます。
他のフローティング化するコマンドについてはkawarimidoll氏の記事にまとめられています。

### `echo`のフローティング表示
![](https://storage.googleapis.com/zenn-user-upload/ec5a4a63f19b-20251214.png =500x)
*`target = "box"`*
`target = "box"`を指定すると、echoなどが右下にフローティング表示されます。表示が消えるまでの時間は`timeout`で指定できます。

## 設定例
先ほどの設定に追加して、自分は次のような設定をしています。
```lua:lua/config/extui.lua
vim.opt.cmdheight = 0

local ok, extui = pcall(require, "vim._extui")
if ok then
    extui.enable({
        enable = true,
        target = "box",
        timeout = 4000,
    })

    -- ここから追加部分

    vim.api.nvim_create_autocmd("LspAttach", { callback = function (ev)
            local client = vim.lsp.get_client_by_id(ev.data.client_id)
            vim.api.nvim_echo({ {"["}, {client.name}, {"] Attached"} }, true, {})
        end
    })

    vim.api.nvim_create_autocmd("LspProgress", {
        callback = function (ev)
            local value = ev.data.params.value
            local client = vim.lsp.get_client_by_id(ev.data.client_id)
            local status = vim.lsp.status()

            if value.kind == "begin" then
                id = vim.api.nvim_echo({ {"["}, {client.name}, {"] "}, { value.title }}, true, {})
            elseif value.kind == "end" then
                vim.api.nvim_echo({ {"["}, {client.name}, {"]"}, { value.title }}, true, {})
            end


        end
    })
end
```

この設定により、先ほどの画像に写っていたような、fidget.nvimなどで行っていたようなLSPのステータス表示ができます。

## みんなも使ってね
extuiはかなり強力な機能です。使い方も多々あると思われるので、ぜひ自分で使い道を発見して共有していただけると幸いです。

## 参考
- [Lua module: vim._extui](https://neovim.io/doc/user/lua.html#_lua-module:-vim._extui)
- [kawarimidoll - Neovim最先端のextuiでcool & smartなcmdlineを手に入れよう](https://zenn.dev/kawarimidoll/articles/4da7458c102c1f)
